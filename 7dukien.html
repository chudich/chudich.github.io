<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Phi Cung Năm, Tháng, Ngày</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f2f2f7;
            color: #000;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .menu-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background-color: #007aff;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .menu-button:hover {
            background-color: #0056b3;
        }
        select {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 18px;
            border-radius: 10px;
            border: 1px solid #c7c7cc;
            background-color: #fff;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            line-height: 1.5;
        }
        .back-link {
            display: block;
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #007aff;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <a href="https://example.com" class="back-link">Về Trang Trước</a>

    <button class="menu-button" id="selectNam">Chọn Năm (Âm Lịch)</button>
    <select id="namSelect" style="display: none;">
        <option value="">Chọn Năm</option>
        <option value="1938_Mậu_Dần">1938 - Mậu Dần</option>
        <option value="1939_Kỷ_Mão">1939 - Kỷ Mão</option>
        <option value="1940_Canh_Thìn">1940 - Canh Thìn</option>
        <option value="1941_Tân_Tị">1941 - Tân Tị</option>
        <option value="1942_Nhâm_Ngọ">1942 - Nhâm Ngọ</option>
        <option value="1943_Quý_Mùi">1943 - Quý Mùi</option>
        <option value="1944_Giáp_Thân">1944 - Giáp Thân</option>
        <option value="1945_Ất_Dậu">1945 - Ất Dậu</option>
        <option value="1946_Bính_Tuất">1946 - Bính Tuất</option>
        <option value="1947_Đinh_Hợi">1947 - Đinh Hợi</option>
        <option value="1948_Mậu_Tý">1948 - Mậu Tý</option>
        <option value="1949_Kỷ_Sửu">1949 - Kỷ Sửu</option>
        <option value="1950_Canh_Dần">1950 - Canh Dần</option>
        <option value="1951_Tân_Mão">1951 - Tân Mão</option>
        <option value="1952_Nhâm_Thìn">1952 - Nhâm Thìn</option>
        <option value="1953_Quý_Tị">1953 - Quý Tị</option>
        <option value="1954_Giáp_Ngọ">1954 - Giáp Ngọ</option>
        <option value="1955_Ất_Mùi">1955 - Ất Mùi</option>
        <option value="1956_Bính_Thân">1956 - Bính Thân</option>
        <option value="1957_Đinh_Dậu">1957 - Đinh Dậu</option>
        <option value="1958_Mậu_Tuất">1958 - Mậu Tuất</option>
        <option value="1959_Kỷ_Hợi">1959 - Kỷ Hợi</option>
        <option value="1960_Canh_Tý">1960 - Canh Tý</option>
        <option value="1961_Tân_Sửu">1961 - Tân Sửu</option>
        <option value="1962_Nhâm_Dần">1962 - Nhâm Dần</option>
        <option value="1963_Quý_Mão">1963 - Quý Mão</option>
        <option value="1964_Giáp_Thìn">1964 - Giáp Thìn</option>
        <option value="1965_Ất_Tị">1965 - Ất Tị</option>
        <option value="1966_Bính_Ngọ">1966 - Bính Ngọ</option>
        <option value="1967_Đinh_Mùi">1967 - Đinh Mùi</option>
        <option value="1968_Mậu_Thân">1968 - Mậu Thân</option>
        <option value="1969_Kỷ_Dậu">1969 - Kỷ Dậu</option>
        <option value="1970_Canh_Tuất">1970 - Canh Tuất</option>
        <option value="1971_Tân_Hợi">1971 - Tân Hợi</option>
        <option value="1972_Nhâm_Tý">1972 - Nhâm Tý</option>
        <option value="1973_Quý_Sửu">1973 - Quý Sửu</option>
        <option value="1974_Giáp_Dần">1974 - Giáp Dần</option>
        <option value="1975_Ất_Mão">1975 - Ất Mão</option>
        <option value="1976_Bính_Thìn">1976 - Bính Thìn</option>
        <option value="1977_Đinh_Tị">1977 - Đinh Tị</option>
        <option value="1978_Mậu_Ngọ">1978 - Mậu Ngọ</option>
        <option value="1979_Kỷ_Mùi">1979 - Kỷ Mùi</option>
        <option value="1980_Canh_Thân">1980 - Canh Thân</option>
        <option value="1981_Tân_Dậu">1981 - Tân Dậu</option>
        <option value="1982_Nhâm_Tuất">1982 - Nhâm Tuất</option>
        <option value="1983_Quý_Hợi">1983 - Quý Hợi</option>
        <option value="1984_Giáp_Tý">1984 - Giáp Tý</option>
        <option value="1985_Ất_Sửu">1985 - Ất Sửu</option>
        <option value="1986_Bính_Dần">1986 - Bính Dần</option>
        <option value="1987_Đinh_Mão">1987 - Đinh Mão</option>
        <option value="1988_Mậu_Thìn">1988 - Mậu Thìn</option>
        <option value="1989_Kỷ_Tị">1989 - Kỷ Tị</option>
        <option value="1990_Canh_Ngọ">1990 - Canh Ngọ</option>
        <option value="1991_Tân_Mùi">1991 - Tân Mùi</option>
        <option value="1992_Nhâm_Thân">1992 - Nhâm Thân</option>
        <option value="1993_Quý_Dậu">1993 - Quý Dậu</option>
        <option value="1994_Giáp_Tuất">1994 - Giáp Tuất</option>
        <option value="1995_Ất_Hợi">1995 - Ất Hợi</option>
        <option value="1996_Bính_Tý">1996 - Bính Tý</option>
        <option value="1997_Đinh_Sửu">1997 - Đinh Sửu</option>
        <option value="1998_Mậu_Dần">1998 - Mậu Dần</option>
        <option value="1999_Kỷ_Mão">1999 - Kỷ Mão</option>
        <option value="2000_Canh_Thìn">2000 - Canh Thìn</option>
        <option value="2001_Tân_Tị">2001 - Tân Tị</option>
        <option value="2002_Nhâm_Ngọ">2002 - Nhâm Ngọ</option>
        <option value="2003_Quý_Mùi">2003 - Quý Mùi</option>
        <option value="2004_Giáp_Thân">2004 - Giáp Thân</option>
        <option value="2005_Ất_Dậu">2005 - Ất Dậu</option>
        <option value="2006_Bính_Tuất">2006 - Bính Tuất</option>
        <option value="2007_Đinh_Hợi">2007 - Đinh Hợi</option>
        <option value="2008_Mậu_Tý">2008 - Mậu Tý</option>
        <option value="2009_Kỷ_Sửu">2009 - Kỷ Sửu</option>
        <option value="2010_Canh_Dần">2010 - Canh Dần</option>
        <option value="2011_Tân_Mão">2011 - Tân Mão</option>
        <option value="2012_Nhâm_Thìn">2012 - Nhâm Thìn</option>
        <option value="2013_Quý_Tị">2013 - Quý Tị</option>
        <option value="2014_Giáp_Ngọ">2014 - Giáp Ngọ</option>
        <option value="2015_Ất_Mùi">2015 - Ất Mùi</option>
        <option value="2016_Bính_Thân">2016 - Bính Thân</option>
        <option value="2017_Đinh_Dậu">2017 - Đinh Dậu</option>
        <option value="2018_Mậu_Tuất">2018 - Mậu Tuất</option>
        <option value="2019_Kỷ_Hợi">2019 - Kỷ Hợi</option>
        <option value="2020_Canh_Tý">2020 - Canh Tý</option>
        <option value="2021_Tân_Sửu">2021 - Tân Sửu</option>
        <option value="2022_Nhâm_Dần">2022 - Nhâm Dần</option>
        <option value="2023_Quý_Mão">2023 - Quý Mão</option>
        <option value="2024_Giáp_Thìn">2024 - Giáp Thìn</option>
        <option value="2025_Ất_Tỵ">2025 - Ất Tỵ</option>
        <option value="2026_Bính_Ngọ">2026 - Bính Ngọ</option>
        <option value="2027_Đinh_Mùi">2027 - Đinh Mùi</option>
        <option value="2028_Mậu_Thân">2028 - Mậu Thân</option>
        <option value="2029_Kỷ_Dậu">2029 - Kỷ Dậu</option>
        <option value="2030_Canh_Tuất">2030 - Canh Tuất</option>
        <option value="2031_Tân_Hợi">2031 - Tân Hợi</option>
        <option value="2032_Nhâm_Tý">2032 - Nhâm Tý</option>
        <option value="2033_Quý_Sửu">2033 - Quý Sửu</option>
        <option value="2034_Giáp_Dần">2034 - Giáp Dần</option>
        <option value="2035_Ất_Mão">2035 - Ất Mão</option>
        <option value="2036_Bính_Thìn">2036 - Bính Thìn</option>
        <option value="2037_Đinh_Tị">2037 - Đinh Tị</option>
        <option value="2038_Mậu_Ngọ">2038 - Mậu Ngọ</option>
        <option value="2039_Kỷ_Mùi">2039 - Kỷ Mùi</option>
        <option value="2040_Canh_Thân">2040 - Canh Thân</option>
        <option value="2041_Tân_Dậu">2041 - Tân Dậu</option>
        <option value="2042_Nhâm_Tuất">2042 - Nhâm Tuất</option>
        <option value="2043_Quý_Hợi">2043 - Quý Hợi</option>
        <option value="2044_Giáp_Tý">2044 - Giáp Tý</option>
        <option value="2045_Ất_Sửu">2045 - Ất Sửu</option>
        <option value="2046_Bính_Dần">2046 - Bính Dần</option>
        <option value="2047_Đinh_Mão">2047 - Đinh Mão</option>
        <option value="2048_Mậu_Thìn">2048 - Mậu Thìn</option>
        <option value="2049_Kỷ_Tị">2049 - Kỷ Tị</option>
        <option value="2050_Canh_Ngọ">2050 - Canh Ngọ</option>
        <option value="2051_Tân_Mùi">2051 - Tân Mùi</option>
        <option value="2052_Nhâm_Thân">2052 - Nhâm Thân</option>
        <option value="2053_Quý_Dậu">2053 - Quý Dậu</option>
        <option value="2054_Giáp_Tuất">2054 - Giáp Tuất</option>
        <option value="2055_Ất_Hợi">2055 - Ất Hợi</option>
        <option value="2056_Bính_Tý">2056 - Bính Tý</option>
        <option value="2057_Đinh_Sửu">2057 - Đinh Sửu</option>
        <option value="2058_Mậu_Dần">2058 - Mậu Dần</option>
        <option value="2059_Kỷ_Mão">2059 - Kỷ Mão</option>
        <option value="2060_Canh_Thìn">2060 - Canh Thìn</option>
        <option value="2061_Tân_Tị">2061 - Tân Tị</option>
        <option value="2062_Nhâm_Ngọ">2062 - Nhâm Ngọ</option>
        <option value="2063_Quý_Mùi">2063 - Quý Mùi</option>
        <option value="2064_Giáp_Thân">2064 - Giáp Thân</option>
        <option value="2065_Ất_Dậu">2065 - Ất Dậu</option>
        <option value="2066_Bính_Tuất">2066 - Bính Tuất</option>
        <option value="2067_Đinh_Hợi">2067 - Đinh Hợi</option>
        <option value="2068_Mậu_Tý">2068 - Mậu Tý</option>
        <option value="2069_Kỷ_Sửu">2069 - Kỷ Sửu</option>
        <option value="2070_Canh_Dần">2070 - Canh Dần</option>
    </select>

    <button class="menu-button" id="selectThang">Chọn Tháng (Âm Lịch)</button>
    <select id="thangSelect" style="display: none;">
        <option value="">Chọn Tháng</option>
    </select>

    <button class="menu-button" id="selectTiet">Chọn Tiết</button>
    <select id="tietSelect" style="display: none;">
        <option value="">Chọn Tiết</option>
        <option value="duong">Đông Chí (Dương Cực)</option>
        <option value="am">Hạ Chí (Âm Cực)</option>
    </select>

    <button class="menu-button" id="selectNgay">Chọn Ngày</button>
    <select id="ngaySelect" style="display: none;">
        <option value="">Chọn Ngày (Hoa Giáp)</option>
        <option value="Giáp Tý">Giáp Tý</option>
        <option value="Ất Sửu">Ất Sửu</option>
        <option value="Bính Dần">Bính Dần</option>
        <option value="Đinh Mão">Đinh Mão</option>
        <option value="Mậu Thìn">Mậu Thìn</option>
        <option value="Kỷ Tị">Kỷ Tị</option>
        <option value="Canh Ngọ">Canh Ngọ</option>
        <option value="Tân Mùi">Tân Mùi</option>
        <option value="Nhâm Thân">Nhâm Thân</option>
        <option value="Quý Dậu">Quý Dậu</option>
        <option value="Giáp Tuất">Giáp Tuất</option>
        <option value="Ất Hợi">Ất Hợi</option>
        <option value="Bính Tý">Bính Tý</option>
        <option value="Đinh Sửu">Đinh Sửu</option>
        <option value="Mậu Dần">Mậu Dần</option>
        <option value="Kỷ Mão">Kỷ Mão</option>
        <option value="Canh Thìn">Canh Thìn</option>
        <option value="Tân Tị">Tân Tị</option>
        <option value="Nhâm Ngọ">Nhâm Ngọ</option>
        <option value="Quý Mùi">Quý Mùi</option>
        <option value="Giáp Thân">Giáp Thân</option>
        <option value="Ất Dậu">Ất Dậu</option>
        <option value="Bính Tuất">Bính Tuất</option>
        <option value="Đinh Hợi">Đinh Hợi</option>
        <option value="Mậu Tý">Mậu Tý</option>
        <option value="Kỷ Sửu">Kỷ Sửu</option>
        <option value="Canh Dần">Canh Dần</option>
        <option value="Tân Mão">Tân Mão</option>
        <option value="Nhâm Thìn">Nhâm Thìn</option>
        <option value="Quý Tị">Quý Tị</option>
        <option value="Giáp Ngọ">Giáp Ngọ</option>
        <option value="Ất Mùi">Ất Mùi</option>
        <option value="Bính Thân">Bính Thân</option>
        <option value="Đinh Dậu">Đinh Dậu</option>
        <option value="Mậu Tuất">Mậu Tuất</option>
        <option value="Kỷ Hợi">Kỷ Hợi</option>
        <option value="Canh Tý">Canh Tý</option>
        <option value="Tân Sửu">Tân Sửu</option>
        <option value="Nhâm Dần">Nhâm Dần</option>
        <option value="Quý Mão">Quý Mão</option>
        <option value="Giáp Thìn">Giáp Thìn</option>
        <option value="Ất Tị">Ất Tị</option>
        <option value="Bính Ngọ">Bính Ngọ</option>
        <option value="Đinh Mùi">Đinh Mùi</option>
        <option value="Mậu Thân">Mậu Thân</option>
        <option value="Kỷ Dậu">Kỷ Dậu</option>
        <option value="Canh Tuất">Canh Tuất</option>
        <option value="Tân Hợi">Tân Hợi</option>
        <option value="Nhâm Tý">Nhâm Tý</option>
        <option value="Quý Sửu">Quý Sửu</option>
        <option value="Giáp Dần">Giáp Dần</option>
        <option value="Ất Mão">Ất Mão</option>
        <option value="Bính Thìn">Bính Thìn</option>
        <option value="Đinh Tị">Đinh Tị</option>
        <option value="Mậu Ngọ">Mậu Ngọ</option>
        <option value="Kỷ Mùi">Kỷ Mùi</option>
        <option value="Canh Thân">Canh Thân</option>
        <option value="Tân Dậu">Tân Dậu</option>
        <option value="Nhâm Tuất">Nhâm Tuất</option>
        <option value="Quý Hợi">Quý Hợi</option>
    </select>

    <button class="menu-button" id="calculate">Tính Phi Cung</button>

    <div id="result"></div>

    <script>
        const weeks = [
            {
                name: 'Giáp Tý',
                days: ['Giáp Tý', 'Ất Sửu', 'Bính Dần', 'Đinh Mão', 'Mậu Thìn', 'Kỷ Tị', 'Canh Ngọ', 'Tân Mùi', 'Nhâm Thân', 'Quý Dậu'],
                yang: 1,
                yin: 9
            },
            {
                name: 'Giáp Tuất',
                days: ['Giáp Tuất', 'Ất Hợi', 'Bính Tý', 'Đinh Sửu', 'Mậu Dần', 'Kỷ Mão', 'Canh Thìn', 'Tân Tị', 'Nhâm Ngọ', 'Quý Mùi'],
                yang: 2,
                yin: 8
            },
            {
                name: 'Giáp Thân',
                days: ['Giáp Thân', 'Ất Dậu', 'Bính Tuất', 'Đinh Hợi', 'Mậu Tý', 'Kỷ Sửu', 'Canh Dần', 'Tân Mão', 'Nhâm Thìn', 'Quý Tị'],
                yang: 3,
                yin: 7
            },
            {
                name: 'Giáp Ngọ',
                days: ['Giáp Ngọ', 'Ất Mùi', 'Bính Thân', 'Đinh Dậu', 'Mậu Tuất', 'Kỷ Hợi', 'Canh Tý', 'Tân Sửu', 'Nhâm Dần', 'Quý Mão'],
                yang: 4,
                yin: 6
            },
            {
                name: 'Giáp Thìn',
                days: ['Giáp Thìn', 'Ất Tị', 'Bính Ngọ', 'Đinh Mùi', 'Mậu Thân', 'Kỷ Dậu', 'Canh Tuất', 'Tân Hợi', 'Nhâm Tý', 'Quý Sửu'],
                yang: 5,
                yin: 5
            },
            {
                name: 'Giáp Dần',
                days: ['Giáp Dần', 'Ất Mão', 'Bính Thìn', 'Đinh Tị', 'Mậu Ngọ', 'Kỷ Mùi', 'Canh Thân', 'Tân Dậu', 'Nhâm Tuất', 'Quý Hợi'],
                yang: 6,
                yin: 4
            }
        ];

        const cungMap = {
            1: 'Khảm',
            2: 'Khôn',
            3: 'Chấn',
            4: 'Tốn',
            6: 'Càn',
            7: 'Đoài',
            8: 'Cấn',
            9: 'Ly'
        };

        const thienCanDuong = ['Giáp', 'Bính', 'Mậu', 'Canh', 'Nhâm'];
        const thienCanAm = ['Ất', 'Đinh', 'Kỷ', 'Tân', 'Quý'];
        const diaChiDuong = ['Tý', 'Dần', 'Thìn', 'Ngọ', 'Thân', 'Tuất'];
        const diaChiAm = ['Sửu', 'Mão', 'Tị', 'Mùi', 'Dậu', 'Hợi'];

        const thienCan = ['Giáp', 'Ất', 'Bính', 'Đinh', 'Mậu', 'Kỷ', 'Canh', 'Tân', 'Nhâm', 'Quý'];
        const diaChi = ['Dần', 'Mão', 'Thìn', 'Tị', 'Ngọ', 'Mùi', 'Thân', 'Dậu', 'Tuất', 'Hợi', 'Tý', 'Sửu'];

        // Hàm tạo danh sách tháng theo Ngũ Hổ Độn
        function generateThangList(thienCanNam) {
            const thangList = [];
            let startCan;
            if (['Giáp', 'Kỷ'].includes(thienCanNam)) startCan = 'Bính';
            else if (['Ất', 'Canh'].includes(thienCanNam)) startCan = 'Mậu';
            else if (['Bính', 'Tân'].includes(thienCanNam)) startCan = 'Canh';
            else if (['Đinh', 'Nhâm'].includes(thienCanNam)) startCan = 'Nhâm';
            else if (['Mậu', 'Quý'].includes(thienCanNam)) startCan = 'Giáp';

            let canIndex = thienCan.indexOf(startCan);
            for (let i = 0; i < 12; i++) {
                const can = thienCan[(canIndex + i) % 10];
                const chi = diaChi[i];
                thangList.push(`${i + 1}_${can}_${chi}`);
            }
            return thangList;
        }

        // Hàm cập nhật dropdown tháng
        function updateThangSelect(nam) {
            const thangSelect = document.getElementById('thangSelect');
            thangSelect.innerHTML = '<option value="">Chọn Tháng</option>';
            if (nam) {
                const thienCanNam = nam.split('_')[1];
                const thangList = generateThangList(thienCanNam);
                thangList.forEach(thang => {
                    const [month, can, chi] = thang.split('_');
                    const option = document.createElement('option');
                    option.value = thang;
                    option.text = `Tháng ${month} - ${can} ${chi}`;
                    thangSelect.appendChild(option);
                });
            }
        }

        // Hàm tính sao trung cung năm (niên vận)
        function tinhPhiCungNam(nam) {
            const [year, can, chi] = nam.split('_');
            // Tính sao trung cung dựa trên chu kỳ nghịch (2025 = Nhị Hắc, mã 2)
            const referenceYear = 2025;
            const referenceStar = 2; // Nhị Hắc
            let maSo = ((referenceYear - parseInt(year) + referenceStar - 1) % 9 + 9) % 9 + 1;
            return { maSo, can, chi };
        }

        // Hàm tính Phi Cung tháng
        function tinhPhiCungThang(diaChiNam, thang) {
            let startMa;
            if (['Tý', 'Ngọ', 'Mão', 'Dậu'].includes(diaChiNam)) startMa = 8; // Nhóm 1
            else if (['Thìn', 'Tuất', 'Sửu', 'Mùi'].includes(diaChiNam)) startMa = 5; // Nhóm 2
            else if (['Dần', 'Thân', 'Tị', 'Hợi'].includes(diaChiNam)) startMa = 2; // Nhóm 3
            else return null;

            let maSo = startMa - (thang - 1);
            while (maSo <= 0) maSo += 9;
            maSo = ((maSo - 1) % 9) + 1; // Chu kỳ 1-9, nghịch hành
            return maSo;
        }

        // Sự kiện hiển thị menu
        document.getElementById('selectNam').addEventListener('click', () => {
            document.getElementById('namSelect').style.display = 'block';
        });

        document.getElementById('selectThang').addEventListener('click', () => {
            document.getElementById('thangSelect').style.display = 'block';
        });

        document.getElementById('selectTiet').addEventListener('click', () => {
            document.getElementById('tietSelect').style.display = 'block';
        });

        document.getElementById('selectNgay').addEventListener('click', () => {
            document.getElementById('ngaySelect').style.display = 'block';
        });

        // Sự kiện cập nhật danh sách tháng khi chọn năm
        document.getElementById('namSelect').addEventListener('change', (e) => {
            updateThangSelect(e.target.value);
        });

        // Sự kiện tính Phi Cung
        document.getElementById('calculate').addEventListener('click', () => {
            const nam = document.getElementById('namSelect').value;
            const thangInput = document.getElementById('thangSelect').value;
            const tiet = document.getElementById('tietSelect').value;
            const ngay = document.getElementById('ngaySelect').value;

            let resultText = '';

            // Tính Phi Cung năm
            if (nam) {
                const { maSo, can, chi } = tinhPhiCungNam(nam);
                let phiCungNam = cungMap[maSo] || '';
                let isNamDuong = thienCanDuong.includes(can) || diaChiDuong.includes(chi);

                if (maSo === 5) {
                    const namType = isNamDuong ? 'Khôn' : 'Cấn';
                    resultText += `Năm ${nam.split('_')[0]} (${can} ${chi}) có Phi Cung là ${namType}. Nếu bạn là Nam thì Phi Cung là Khôn; nếu bạn là Nữ thì Phi Cung là Cấn.\n\n`;
                } else if (phiCungNam) {
                    resultText += `Năm ${nam.split('_')[0]} (${can} ${chi}) có Phi Cung là ${phiCungNam}.\n\n`;
                } else {
                    resultText += `Mã số năm ${maSo} không hợp lệ.\n\n`;
                }
            }

            // Tính Phi Cung tháng
            if (nam && thangInput) {
                const [thang, canThang, chiThang] = thangInput.split('_');
                const diaChiNam = nam.split('_')[2];
                const maSoThang = tinhPhiCungThang(diaChiNam, parseInt(thang));
                let phiCungThang = cungMap[maSoThang] || '';
                let isThangDuong = thienCanDuong.includes(canThang) || diaChiDuong.includes(chiThang);

                if (maSoThang === 5) {
                    const thangType = isThangDuong ? 'Khôn' : 'Cấn';
                    resultText += `Tháng ${thang} (${canThang} ${chiThang}) có Phi Cung là ${thangType}. Nếu bạn là Nam thì Phi Cung là Khôn; nếu bạn là Nữ thì Phi Cung là Cấn.\n\n`;
                } else if (phiCungThang) {
                    resultText += `Tháng ${thang} (${canThang} ${chiThang}) có Phi Cung là ${phiCungThang}.\n\n`;
                } else {
                    resultText += `Mã số tháng ${maSoThang} không hợp lệ.\n\n`;
                }
            }

            // Tính Phi Cung ngày
            if (tiet && ngay) {
                let selectedWeek = null;
                let index = -1;
                for (let week of weeks) {
                    index = week.days.indexOf(ngay);
                    if (index !== -1) {
                        selectedWeek = week;
                        break;
                    }
                }

                if (!selectedWeek) {
                    resultText += 'Không tìm thấy ngày.';
                    document.getElementById('result').innerHTML = resultText;
                    return;
                }

                const startMa = tiet === 'duong' ? selectedWeek.yang : selectedWeek.yin;
                let maSo;
                if (tiet === 'am') {
                    maSo = startMa - index;
                    while (maSo <= 0) maSo += 9;
                    maSo = ((maSo - 1) % 9) + 1; // Chu kỳ 1-9, nghịch
                } else {
                    maSo = startMa + index;
                    maSo = ((maSo - 1) % 9) + 1; // Chu kỳ 1-9, thuận
                }

                let phiCung = cungMap[maSo] || '';
                let isNgayDuong = false;
                const [can, chi] = ngay.split(' ');
                if (thienCanDuong.includes(can) || diaChiDuong.includes(chi)) {
                    isNgayDuong = true;
                }

                if (maSo === 5) {
                    const ngayType = isNgayDuong ? 'Khôn' : 'Cấn';
                    resultText += `Ngày bạn muốn xem (${ngay}) có Phi Cung là ${ngayType}. Nếu bạn là Nam thì Phi Cung là Khôn; nếu bạn là Nữ thì Phi Cung là Cấn.`;
                } else if (phiCung) {
                    resultText += `Ngày bạn muốn xem (${ngay}) có Phi Cung là ${phiCung}.`;
                } else {
                    resultText += `Mã số ngày ${maSo} không hợp lệ hoặc chưa được định nghĩa.`;
                }
            }

            if (!resultText) {
                resultText = 'Vui lòng chọn đầy đủ thông tin (Năm, Tháng, Tiết, hoặc Ngày).';
            }

            document.getElementById('result').innerHTML = resultText.replace(/\n/g, '<br>');
        });
    </script>
</body>
</html>