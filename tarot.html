<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tr·∫£i B√†i Tarot Linh ·ª®ng - NƒÉng L∆∞·ª£ng B·∫≠t S√°ng</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>
    :root {
        --color-bg: #10121b;
        --color-card: #1a1d29;
        --color-accent: #d2baff;
        --color-glow: #b388ff;
        --transition: 0.6s ease;
    }
    body {
        background: radial-gradient(circle at center, #12131d, #0c0d13);
        color: #e8e8f0;
        font-family: 'Poppins', sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        min-height: 100vh;
        margin: 0;
        padding: 1rem;
    }
    h1 {
        font-size: 1.7rem;
        letter-spacing: 1px;
        color: var(--color-accent);
        text-shadow: 0 0 8px #b88cffcc;
    }
    #cards-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
    }
    .card-item {
        perspective: 900px;
        width: 130px;
        height: 200px;
    }
    .card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform var(--transition);
        transform-style: preserve-3d;
        cursor: pointer;
    }
    .card-item.revealed .card-inner {
        transform: rotateY(180deg);
    }
    .card-back, .card-content {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 12px;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .card-back {
        background: linear-gradient(145deg, #1b1d2a, #2a2c3d);
        box-shadow: inset 0 0 10px #000, 0 0 8px #3a3a55;
    }
    .card-back span {
        font-size: 0.9rem;
        margin-top: 0.5rem;
        color: #b9b9c7;
    }
    .card-content {
        background: var(--color-card);
        color: #fff;
        transform: rotateY(180deg);
        box-shadow: 0 0 12px rgba(150, 100, 255, 0.1);
        transition: box-shadow 0.6s, transform 0.6s;
    }
    .card-item.revealed .card-content.energy-flare {
        box-shadow: 0 0 25px var(--color-glow), 0 0 60px var(--color-glow);
        animation: pulseEnergy 1.5s ease-out;
    }
    @keyframes pulseEnergy {
        0% { transform: scale(1) rotateY(180deg); box-shadow: 0 0 0px var(--color-glow); }
        40% { transform: scale(1.05) rotateY(180deg); box-shadow: 0 0 25px var(--color-glow); }
        80% { transform: scale(0.98) rotateY(180deg); }
        100% { transform: scale(1) rotateY(180deg); }
    }
    .card-content strong {
        font-size: 0.85rem;
        color: #cdb9ff;
    }
    .card-content span {
        display: block;
        margin-top: 4px;
        font-size: 0.8rem;
    }
    #drawing-status {
        margin-top: 1.2rem;
        font-style: italic;
        opacity: 0.8;
    }
    #copy-message {
        margin-top: 10px;
        color: #9fffdf;
        font-size: 0.9rem;
        display: none;
    }
    .card-buttons button {
        background: #292c3f;
        color: #d2baff;
        border: 1px solid #5e4ca8;
        border-radius: 12px;
        padding: 10px 18px;
        margin: 4px;
        cursor: pointer;
        transition: all 0.25s;
    }
    .card-buttons button:hover {
        background: #3d2f6b;
        color: #fff;
        box-shadow: 0 0 8px #b08eff;
    }
</style>
</head>
<body>
<h1>Tr·∫£i B√†i Tarot Linh ·ª®ng ‚ú®</h1>

<div class="card-buttons">
    <button onclick="showEntropyForm(3,'Tr·∫£i B√†i Tarot 3 L√°')">3 L√°</button>
    <button onclick="showEntropyForm(5,'Tr·∫£i B√†i Tarot 5 L√°')">5 L√°</button>
    <button onclick="showCustomCardForm()">Tu·ª≥ Ch·ªçn</button>
</div>

<div id="cards-container"></div>
<div id="drawing-status"></div>
<div id="copy-message">üìã ƒê√£ sao ch√©p tr·∫£i b√†i!</div>

<!-- Form nh·∫≠p entropy -->
<div id="entropy-form-container" style="display:none;flex-direction:column;align-items:center;margin-top:1rem;">
    <h3 id="entropy-title"></h3>
    <input id="entropy-input" placeholder="Nh·∫≠p nƒÉng l∆∞·ª£ng k·∫øt n·ªëi..." style="padding:8px;width:80%;max-width:320px;">
    <button id="submit-entropy">X√°c nh·∫≠n</button>
</div>

<!-- Form tu·ª≥ ch·ªçn -->
<div id="custom-card-form-container" style="display:none;flex-direction:column;align-items:center;margin-top:1rem;">
    <input id="num-cards-input" placeholder="S·ªë l√° (1‚Äì78)" type="number" style="padding:8px;width:80%;max-width:200px;">
    <input id="custom-entropy-input" placeholder="T·ª´ kho√° nƒÉng l∆∞·ª£ng..." style="padding:8px;width:80%;max-width:320px;margin-top:8px;">
    <button id="submit-custom-cards">R√∫t B√†i</button>
</div>

<script>
/* ======================================
   üîÆ Tarot Engine: Phi√™n b·∫£n Linh ·ª®ng
   ====================================== */
const MAJOR_ARCANA = ['0 - The Fool','I - The Magician','II - The High Priestess','III - The Empress','IV - The Emperor','V - The Hierophant','VI - The Lovers','VII - The Chariot','VIII - Strength','IX - The Hermit','X - Wheel of Fortune','XI - Justice','XII - The Hanged Man','XIII - Death','XIV - Temperance','XV - The Devil','XVI - The Tower','XVII - The Star','XVIII - The Moon','XIX - The Sun','XX - Judgement','XXI - The World'];
const MINOR_ARCANA_SUITS=['Wands','Cups','Swords','Pentacles'];
const CARD_RANKS=['Ace','2','3','4','5','6','7','8','9','10','Page','Knight','Queen','King'];
const allButtons=document.querySelectorAll('.card-buttons button');
const cardsContainer=document.getElementById('cards-container');
const drawingStatus=document.getElementById('drawing-status');
const entropyFormContainer=document.getElementById('entropy-form-container');
const entropyInput=document.getElementById('entropy-input');
const submitEntropyButton=document.getElementById('submit-entropy');
const customCardFormContainer=document.getElementById('custom-card-form-container');
const numCardsInput=document.getElementById('num-cards-input');
const customEntropyInput=document.getElementById('custom-entropy-input');
const submitCustomCardsButton=document.getElementById('submit-custom-cards');
let currentNumCards=0,currentSpreadName='',currentDrawnCards=[];
const DRAW_DELAY=2300;

function createDeck(){
    let d=[...MAJOR_ARCANA];
    for(const s of MINOR_ARCANA_SUITS){ for(const r of CARD_RANKS){ d.push(`${r} of ${s}`); } }
    return d;
}
const FULL_DECK=createDeck();

function generateSeed(input){
    const t=input.trim().toLowerCase();
    let h=0; for(let i=0;i<t.length;i++){ h=(h<<5)-h+t.charCodeAt(i); h|=0; }
    const now=Date.now(); let m=(h*2654435761+now)^(now%7919);
    m^=(m<<13);m^=(m>>17);m^=(m<<5);
    return Math.abs(m%4294967296);
}
function seededRandomGenerator(s){ return function(){ s|=0; s=s+0x6D2B79F5|0; var t=Math.imul(s^s>>>15,1|s); t=t+Math.imul(t^t>>>7,61|t)^t; return((t^t>>>14)>>>0)/4294967296; }; }

function drawCards(numCards,spreadName,entropyValue){
    cardsContainer.innerHTML=''; drawingStatus.textContent='ƒêang k·∫øt n·ªëi nƒÉng l∆∞·ª£ng...';
    const deck=[...FULL_DECK];
    currentDrawnCards=[]; window.lastEntropyValue=entropyValue;
    let seed=generateSeed(entropyValue);
    const rng=seededRandomGenerator(seed);

    // Shuffle
    for(let i=deck.length-1;i>0;i--){ const j=Math.floor(rng()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }

    // R√∫t b√†i
    const drawnIndices=new Set();
    for(let i=0;i<numCards;i++){
        const localSeed=Math.floor(rng()*1e9)+(i+1)*77;
        const localRng=seededRandomGenerator(localSeed);
        let idx=Math.floor(localRng()*deck.length);
        while(drawnIndices.has(idx)) idx=Math.floor(localRng()*deck.length);
        drawnIndices.add(idx);
        const orientation=localRng()<0.55?'U':'R';
        const card=deck[idx];
        currentDrawnCards.push({name:card,orientation});
        const cardItem=document.createElement('div');
        cardItem.className='card-item';
        cardItem.innerHTML=`
            <div class="card-inner">
                <div class="card-back"><i class="fas fa-hand-sparkles"></i><span>L√° ${i+1}</span></div>
                <div class="card-content"></div>
            </div>`;
        cardsContainer.appendChild(cardItem);
    }

    for(let i=0;i<numCards;i++){
        setTimeout(()=>revealCard(i,numCards), (i+1)*DRAW_DELAY);
    }
}

function revealCard(i,total){
    const card=currentDrawnCards[i]; const el=cardsContainer.children[i];
    if(!card||!el)return;
    drawingStatus.textContent=`ƒêang r√∫t l√° ${i+1}/${total}...`;
    const content=el.querySelector('.card-content');
    content.innerHTML=`<strong>${card.name}</strong><span>${card.orientation==='U'?'Xu√¥i':'Ng∆∞·ª£c'}</span>`;
    el.classList.add('revealed');
    content.classList.add('energy-flare');
    if(i===total-1){
        setTimeout(()=>{
            drawingStatus.textContent='Ho√†n t·∫•t! ‚ú®';
            enableAllButtons();
            copyToClipboard();
        },1000);
    }
}

function disableAllButtons(){ allButtons.forEach(b=>b.disabled=true); }
function enableAllButtons(){ allButtons.forEach(b=>b.disabled=false); }

function copyToClipboard(){
    if(currentDrawnCards.length===0)return;
    const entropy=window.lastEntropyValue||'NƒÉng l∆∞·ª£ng ng·∫´u nhi√™n';
    const lines=currentDrawnCards.map((c,i)=>`L√° ${i+1}: ${c.name} (${c.orientation==='U'?'Xu√¥i':'Ng∆∞·ª£c'})`).join('\n');
    const text=`${currentSpreadName}:\n${lines}\n\n[Y√™u c·∫ßu gi·∫£i b√†i chi ti·∫øt k·∫øt h·ª£p v·ªõi t·ª´ kh√≥a: "${entropy}"]`;
    navigator.clipboard.writeText(text).then(()=>{
        const msg=document.getElementById('copy-message');
        msg.style.display='block'; setTimeout(()=>msg.style.display='none',2500);
    });
}

// FORM X·ª¨ L√ù
function showEntropyForm(num,spread){
    currentNumCards=num; currentSpreadName=spread;
    disableAllButtons();
    entropyFormContainer.style.display='flex';
    document.getElementById('entropy-title').textContent=`K·∫øt n·ªëi nƒÉng l∆∞·ª£ng cho ${spread}`;
    entropyInput.value=''; entropyInput.focus();
}
submitEntropyButton.onclick=function(){
    entropyFormContainer.style.display='none';
    drawCards(currentNumCards,currentSpreadName,entropyInput.value.trim());
};
function showCustomCardForm(){
    currentSpreadName='Tr·∫£i B√†i Tu·ª≥ Ch·ªçn';
    disableAllButtons();
    customCardFormContainer.style.display='flex';
    numCardsInput.focus();
}
submitCustomCardsButton.onclick=function(){
    const n=parseInt(numCardsInput.value.trim());
    if(isNaN(n)||n<1||n>78){alert('Vui l√≤ng nh·∫≠p s·ªë l√° h·ª£p l·ªá (1‚Äì78).');return;}
    customCardFormContainer.style.display='none';
    drawCards(n,currentSpreadName,customEntropyInput.value.trim());
};
</script>
</body>
</html>